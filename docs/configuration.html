<!DOCTYPE html>
    <!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 6 March 2020 
 | Rendered using BloomReach Forge Maven Skin 3.1.1 based on Apache Maven Fluido Skin
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                  <meta name="Date-Revision-yyyymmdd" content="20200306" />
              <meta http-equiv="Content-Language" content="en" />
      <title>HST Spring Security Support Documentation &#x2013; Configuration</title>
  <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-3.1.1.min.css"/>
  <link rel="stylesheet" href="./css/forge-maven-skin-3.1.1.min.css"/>
  <link rel="stylesheet" href="./css/site.css" />
  <link rel="stylesheet" href="./css/print.css" media="print" />
  <link rel="icon" type="image/png" href="./images/skin/logo_64.png" sizes="64x64">

  
  <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-3.1.1.min.js"></script>
  <script type="text/javascript" src="./js/forge-maven-skin-3.1.1.min.js"></script>

    </head>
<body class="topBarDisabled">
                        <a href="https://github.com/bloomreach-forge/hst-spring-security">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
         src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
         alt="Fork me on GitHub">
  </a>
          <div class="container-fluid">
  <div id="banner">
    <div id="logo">
                        <a href="https://bloomreach-forge.github.io">
        <img src="./images/skin/logo.png" alt="BloomReach Forge Logo" />
      </a>
    </div>
    <div class="pull-left">              <div id="bannerLeft">    <h1>HST Spring Security Support</h1>
    </div>
              </div>
    <div class="pull-right"></div>
    <div class="clear"><hr/></div>
  </div>

  <div id="breadcrumbs">
                            <div class="links">
      <a href="https://documentation.bloomreach.com">documentation.bloomreach.com</a>
      <a href="https://developers.bloomreach.com">developers.bloomreach.com</a>
    </div>
    <ul class="breadcrumb">
    
  <li id="publishDate">published: 6 March 2020  
  </li>
  
        
            </ul>
    <div class="clear"><hr/></div>
  </div>
<div class="row-fluid">
  <div id="leftColumn" class="span2">
    <div class="well sidebar-nav">
    
    <ul class="nav nav-list">
            <li class="nav-header">Home</li>
              <li>  <a href="index.html" title="Home">  <span class="none"></span>  Home</a>  </li>
        <li>  <a href="release-notes.html" title="Release Notes">  <span class="none"></span>  Release Notes</a>  </li>
                  <li class="nav-header">Usage</li>
              <li>  <a href="install.html" title="Installation">  <span class="none"></span>  Installation</a>  </li>
        <li class="active">  <a href="#"><span class="none"></span>Configuration</a>
  </li>
        <li>  <a href="hippouserdetails.html" title="Detail on HippoAuthenticationProvider">  <span class="none"></span>  Detail on HippoAuthenticationProvider</a>  </li>
        <li>  <a href="runningdemo.html" title="Running Demo Application">  <span class="none"></span>  Running Demo Application</a>  </li>
        <li>  <a href="config-httpd.html" title="Configuring Apache HTTPd">  <span class="none"></span>  Configuring Apache HTTPd</a>  </li>
        <li>  <a href="build-from-source.html" title="Build from source">  <span class="none"></span>  Build from source</a>  </li>
                  <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                    <li>  <a href="project-info.html" title="Project Information">  <span class="icon-chevron-right"></span>  Project Information</a>  </li>
                                                        <li>  <a href="project-reports.html" title="Project Reports">  <span class="icon-chevron-right"></span>  Project Reports</a>  </li>
        </ul>
    
          <hr />
      <div id="poweredBy">
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
              <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">  <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />  </a>
          </div>
    </div>
  </div>
  <div id="bodyColumn"  class="span10" >
    
  
    <div class="section">
<h2><a name="Configuration"></a>Configuration</h2>
      
<div class="section">
<h3><a name="Configure_Spring_Web_Application_Context_with_Spring_Security_Configuration"></a>Configure Spring Web Application Context with Spring Security Configuration</h3>
        
<p>
          First you need to configure Spring Web Application Context in your web.xml.
        </p>
        
<div class="brush: xml">
        
<div class="source"><pre>
&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  version=&quot;2.4&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee   http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;&gt;

  &lt;display-name&gt;Example HST SITE Web Application&lt;/display-name&gt;

  &lt;!-- ... --&gt;

  &lt;!--
    Configure Spring Web Application Context configuration files.
    You should include your spring security configuration in any file(s) in the following.
  --&gt;
  &lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;
      /WEB-INF/applicationContext.xml
      /WEB-INF/applicationContext-security.xml
    &lt;/param-value&gt;
  &lt;/context-param&gt;

  &lt;!-- ... --&gt;

  &lt;!--
    Configure Spring Security Filter.
    Usually you may just copy and paste the following into your web application descriptor.
  --&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
  &lt;/filter&gt;

  &lt;!-- ... --&gt;

  &lt;!--
    Configure Spring Security Filter Mapping.
    Usually you may just copy and paste the following into your web application descriptor.
  --&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;/filter-mapping&gt;

  &lt;!-- ... --&gt;

  &lt;!--
    Configure Spring Web Application Context Loader Listener.
  --&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
  &lt;/listener&gt;

  &lt;!-- ... --&gt;

&lt;/web-app&gt;
        </pre></div>
        </div>
      </div>
      
<div class="section">
<h3><a name="Configuring_Spring_Web_Application_Context"></a>Configuring Spring Web Application Context</h3>
        
<p>
          You may put any beans in your Spring Web Application Context configuration.
          In this example, we assume you will add your custom beans in /WEB-INF/applicationContext.xml.
        </p>
        
<div class="brush: xml">
        
<div class="source"><pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:lang=&quot;http://www.springframework.org/schema/lang&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:util=&quot;http://www.springframework.org/schema/util&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/lang http://www.springframework.org/schema/beans/spring-lang.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;

  &lt;!-- You may add any beans here. --&gt;

&lt;/beans&gt;
        </pre></div>
        </div>
      </div>
      
<div class="section">
<h3><a name="Configuring_Spring_Security"></a>Configuring Spring Security</h3>
        
<p>
          Here's an example of Spring Security configuration in /WEB-INF/applicationContext-security.xml.
        </p>
        
<p>
          <b><i>Note:</i></b>
          In the following example, 'hippoAuthenticationProvider' bean is used
          as the default Spring Security authentication provider component.
          The 'hippoAuthenticationProvider' simply authenticates users against Hippo Repository user/group store.
          If you want to authenticate users against other security stores such as LDAP, RDBMS, etc.,
          then you should configure other authentication provider component instead.
          Please refer to <a class="externalLink" href="http://projects.spring.io/spring-security/" target="_blank">Spring Security</a>
          documentation site for other available authentication providers.
        </p>
        
<div class="brush: xml">
        
<div class="source"><pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans:beans xmlns=&quot;http://www.springframework.org/schema/security&quot;
       xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:lang=&quot;http://www.springframework.org/schema/lang&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:util=&quot;http://www.springframework.org/schema/util&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/lang http://www.springframework.org/schema/beans/spring-lang.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
                           http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd&quot;&gt;

  &lt;!-- Static Resources --&gt;
  &lt;http pattern=&quot;/css/**&quot; security=&quot;none&quot;/&gt;
  &lt;http pattern=&quot;/images/**&quot; security=&quot;none&quot;/&gt;
  &lt;http pattern=&quot;/script/**&quot; security=&quot;none&quot;/&gt;
  &lt;http pattern=&quot;/binaries/**&quot; security=&quot;none&quot;/&gt;
  &lt;http pattern=&quot;/webfiles/**&quot; security=&quot;none&quot; /&gt;

  &lt;!-- Channel Manager requests may bypass authentication --&gt;
  &lt;http pattern=&quot;/_rp/**&quot; security=&quot;none&quot;/&gt;
  &lt;http pattern=&quot;/_cmsrest/**&quot; security=&quot;none&quot;/&gt;
  &lt;http pattern=&quot;/_cmsinternal/**&quot; security=&quot;none&quot;/&gt;
  &lt;http pattern=&quot;/_cmssessioncontext/**&quot; security=&quot;none&quot;/&gt;

  &lt;http auto-config=&quot;true&quot; use-expressions=&quot;true&quot; disable-url-rewriting=&quot;false&quot;&gt;

    &lt;!--
      As of Spring Security 4.0, CSRF protection is enabled by default with XML configuration.
      If you would like to disable CSRF protection, uncomment the corresponding XML configuration below.
    --&gt;
    &lt;!--
    &lt;csrf disabled=&quot;true&quot;/&gt;
    --&gt;

    &lt;!--
      SAMEORIGIN should be set for X-Frame-Options header to allow channel manager to load preview pages in iframe.
      See https://docs.spring.io/spring-security/site/docs/current/reference/html/headers.html#headers-frame-options for detail.
    --&gt;
    &lt;headers&gt;
      &lt;frame-options policy=&quot;SAMEORIGIN&quot; /&gt;
    &lt;/headers&gt;

    &lt;!-- Example configuration to allow anonymous access as well as authenticated access. --&gt;
    &lt;intercept-url pattern=&quot;/login.jsp*&quot; access=&quot;isAnonymous() or hasRole('everybody')&quot; /&gt;
    &lt;intercept-url pattern=&quot;/logout*&quot; access=&quot;isAnonymous() or hasRole('everybody')&quot; /&gt;

    &lt;!-- Example configuration to allow only authenticated access to users having 'ROLE_everybody'. --&gt;
    &lt;intercept-url pattern=&quot;/**&quot; access=&quot;hasRole('everybody')&quot; /&gt;

    &lt;!-- Note: Enable http-basic element instead of form-login if you want to use Basic Authentication. --&gt;
    &lt;!--
    &lt;http-basic /&gt;
    --&gt;
    &lt;form-login login-page=&quot;/login.jsp&quot;
                default-target-url=&quot;/&quot;
                always-use-default-target=&quot;true&quot; /&gt;

    &lt;logout invalidate-session=&quot;true&quot; logout-success-url=&quot;/&quot; logout-url=&quot;/logout&quot; /&gt;

  &lt;/http&gt;

  &lt;!--
    Authentication Manager configuration with Hippo Repository based Authentication Provider configuration ('hippoAuthenticationProvider').
    However, you can use any other authentication provider(s) if you don't need to authenticate users against Hippo Repository.
  --&gt;
  &lt;authentication-manager&gt;
    &lt;authentication-provider ref=&quot;hippoAuthenticationProvider&quot; /&gt;
  &lt;/authentication-manager&gt;

  &lt;!--
    Hippo Repository based Authentication Provider. This Authentication Provider provide authentication against Hippo Repository Security Store.
    If you don't need to authenticate users against Hippo Repository, you don't have to include the following bean.
  --&gt;
  &lt;beans:bean id=&quot;hippoAuthenticationProvider&quot;
              class=&quot;org.onehippo.forge.security.support.springsecurity.authentication.HippoAuthenticationProvider&quot;&gt;
  &lt;/beans:bean&gt;

&lt;/beans:beans&gt;
        </pre></div>
        </div>
      </div>
      
<div class="section">
<h3><a name="Configuring_HippoUserDetailsService_explicitly"></a>Configuring HippoUserDetailsService explicitly</h3>
        
<p>
          The <tt>hippoAuthenticationProvider</tt> bean shown above creates a <tt>HippoUserDetailsService</tt> bean automatically
          with default property values
          if not provided explicitly through bean configurations.
        </p>
        
<p>
          You can also define <tt>HippoUserDetailsService</tt> bean explicitly like the following example and inject it
          to <tt>hippoAuthenticationProvider</tt> bean for more detailed configuration:
        </p>
        
<div class="brush: xml">
        
<div class="source"><pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans:beans xmlns=&quot;http://www.springframework.org/schema/security&quot;
       xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:lang=&quot;http://www.springframework.org/schema/lang&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:util=&quot;http://www.springframework.org/schema/util&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/lang http://www.springframework.org/schema/beans/spring-lang.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd
                           http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd&quot;&gt;

  &lt;!-- SNIP --&gt;

  &lt;beans:bean id=&quot;hippoUserDetailsService&quot; class=&quot;org.onehippo.forge.security.support.springsecurity.authentication.HippoUserDetailsServiceImpl&quot;&gt;
    &lt;beans:property name=&quot;defaultRoleName&quot; value=&quot;everybody&quot; /&gt;
    &lt;beans:property name=&quot;roleDomainName&quot; value=&quot;everywhere&quot; /&gt;
  &lt;/beans:bean&gt;

  &lt;beans:bean id=&quot;hippoAuthenticationProvider&quot;
              class=&quot;org.onehippo.forge.security.support.springsecurity.authentication.HippoAuthenticationProvider&quot;&gt;
    &lt;beans:property name=&quot;hippoUserDetailsService&quot; ref=&quot;hippoUserDetailsService&quot; /&gt;
  &lt;/beans:bean&gt;

&lt;/beans:beans&gt;
        </pre></div>
        </div>
      </div>
      
<div class="section">
<h3><a name="Adding_SpringSecurityValve_into_the_Existing_Pipelines"></a>Adding SpringSecurityValve into the Existing Pipeline(s)</h3>
        
<p>
          In order to enable Spring Security Integration in your SITE application, you should insert 'SpringSecurityValve' into your existing pipelines.
        </p>
        
<p>
          Basically, <tt>SpringSecurityValve</tt> is responsible for
          reading the <tt>org.springframework.security.core.Authentication</tt> instance if exists,
          and establishing <tt>javax.security.auth.Subject</tt> for the whole HST-2 request processing
          by converting <tt>org.springframework.security.core.userdetails.UserDetails</tt> into a set of
          <tt>java.security.Principal</tt>s
          (user principal and role principals from the collection of <tt>org.springframework.security.core.GrantedAuthority</tt>).
        </p>
        
<p>
          There can be three different pipelines in your project:
        </p>
        
<ul>
          
<li>DefaultSitePipeline: The default website pipeline</li>
          
<li>JaxrsRestPlainPipeline: The Plain JAX-RS Service pipeline</li>
          
<li>JaxrsRestContentPipeline: The Content/Context Aware JAX-RS Service pipeline</li>
        </ul>
        
<p>
          In the example below, we append SpringSecurityValve to the initializing valves of the default pipeline only.
          If you want to enable Spring Security Integration in either of JAX-RS pipelines, you will
          need to copy and paste the second bean definition block with changing the pipeline name argument.
        </p>
        
<div class="brush: xml">
        
<div class="source"><pre>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:lang=&quot;http://www.springframework.org/schema/lang&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:util=&quot;http://www.springframework.org/schema/util&quot;
       xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/lang http://www.springframework.org/schema/beans/spring-lang.xsd
                           http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd
                           http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;&gt;

  &lt;!-- Defininig SpringSecurityValve --&gt;
  &lt;bean id=&quot;springSecurityValve&quot; class=&quot;org.onehippo.forge.security.support.springsecurity.container.SpringSecurityValve&quot;&gt;
    &lt;property name=&quot;valveName&quot; value=&quot;springSecurityValve&quot; /&gt;
  &lt;/bean&gt;

  &lt;!--
    Inserting SpringSecurityValve into the default pipeline.
    You may copy and paste the following block to insert the SpringSecurityValve for more pipelines.
    'DefaultSitePipeline' is for the default website pipeline.
    'JaxrsRestContentPipeline' is for the Content/Context Aware JAX-RS Service pipeline.
    'JaxrsRestPlainPipeline' is for the Plain JAX-RS Service pipeline.
  --&gt;
  &lt;bean class=&quot;org.springframework.beans.factory.config.MethodInvokingFactoryBean&quot;&gt;
    &lt;property name=&quot;targetObject&quot;&gt;
      &lt;bean class=&quot;org.springframework.beans.factory.config.MethodInvokingFactoryBean&quot;&gt;
        &lt;property name=&quot;targetObject&quot; ref=&quot;org.hippoecm.hst.core.container.Pipelines&quot; /&gt;
        &lt;property name=&quot;targetMethod&quot; value=&quot;getPipeline&quot; /&gt;
        &lt;property name=&quot;arguments&quot;&gt;
          &lt;list&gt;
            &lt;!--
              You may use one of the following: 'DefaultSitePipeline', 'JaxrsRestContentPipeline' and 'JaxrsRestPlainPipeline'.
            --&gt;
            &lt;value&gt;DefaultSitePipeline&lt;/value&gt;
          &lt;/list&gt;
        &lt;/property&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name=&quot;targetMethod&quot; value=&quot;addInitializationValve&quot; /&gt;
    &lt;property name=&quot;arguments&quot;&gt;
      &lt;ref bean=&quot;springSecurityValve&quot; /&gt;
    &lt;/property&gt;
  &lt;/bean&gt;

&lt;/beans&gt;
        </pre></div>
        </div>
      </div>
      
<div class="section">
<h3><a name="Securing_Your_Site"></a>Securing Your Site</h3>
        
<p>
          Now, you can secure your web site by setting 'hst:authenticated', 'hst:roles' or 'hst:users' either 'hst:sitemapitem' node or 'hst:mount' node.
        </p>
        
<p>
          For example, if you have 'securedresource' sitemap item, and it has 'hst:authenticated=true' and 'hst:roles=ROLE_admin,ROLE_everybody', then
          any requests to the sitemap item will be allowed only authenticated users.
        </p>
        <i>
          Note: Because the role name with Spring Security should be prefixed by 'ROLE_' by default, you will need to prefix the role name by the prefix
                when configuring the hst:roles property.
        </i>
        
<p>
          HST Spring Security Support supports the same feature for authorization as the default HST-2 Security module provides.
          So, please refer to the following link in order to learn how to set authorization.
        </p>
        
<ul>
          
<li><a class="externalLink" href="http://www.onehippo.org/library/concepts/security/hst-2-authentication-and-authorization-support.html">HST-2 Authentication and Authorization Support</a>.</li>
        </ul>
      </div>
      
<div class="section">
<h3><a name="Using_Standard_Security_APIs"></a>Using Standard Security APIs</h3>
        
<p>
          Also, you can use JavaEE standard Security APIs now in your components or servlet/filter for programmatic security checks such as:
        </p>
        
<ul>
          
<li><tt>javax.servlet.http.HttpServletRequest#getUserPrincipal()</tt></li>
          
<li><tt>javax.servlet.http.HttpServletRequest#isUserInRole(java.lang.String role)</tt></li>
        </ul>
      </div>
    </div>
  

    </div>
    </div>
    </div>
    <hr/>
    <footer>
    <div class="container-fluid">
      <div class="row-fluid">
          <p class="copyright">Copyright &copy;      2020.
          <a href="https://www.bloomreach.com">BloomReach Inc.</a>.
      
</p>
    </div>
            </div>
  </footer>
    </body>
</html>

